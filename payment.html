<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payment - NARI MARKETS</title>
<link rel="stylesheet" href="style5.css">
</head>
<body>

<div class="main">
    <h3>Payment</h3>

    <div class="card-icon" id="cardIcon"></div>

    <form id="paymentForm">

        <label>Card Number</label>
        <input type="text" id="cardNumber" maxlength="19" placeholder="xxxx xxxx xxxx xxxx" required>

        <div class="row">
            <div>
                <label>Expiry</label>
                <input type="month" required>
            </div>
            <div>
                <label>CVV</label>
                <input type="password" maxlength="4" placeholder="***" required>
            </div>
        </div>

        <label>Name on Card</label>
        <input type="text" placeholder="Full name" required>

        <button type="submit">Pay Securely</button>
    </form>
</div>

<script>
const token = localStorage.getItem("token");

if (!token) {
    alert("Please log in first");
    window.location.href = "index.html";
}

// SINGLE PLAN — NO SELECTION REQUIRED
const plan = "monthly";
const amount = 5000;

const form = document.getElementById("paymentForm");

form.addEventListener("submit", async (e) => {
    e.preventDefault(); // ⛔ STOP PAGE REFRESH

    try {
        const res = await fetch("https://nari-15.onrender.com/api/subscribe", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                Authorization: "Bearer " + token
            },
            body: JSON.stringify({ plan })
        });

        const data = await res.json();

        if (!res.ok) {
            alert(data.message || "Payment failed");
            return;
        }

        alert("✅ Subscription activated!");
        window.location.href = "page2.html";

    } catch (err) {
        console.error(err);
        alert("Server error. Try again.");
    }
});
</script>


</body>

</html>


